implementar o sistema de roteiro diÃ¡rio offline/online para o app do leiturista.

âœ… VISÃƒO GERAL
O objetivo Ã©:

Sincronizar o roteiro do dia com Supabase.

Salvar localmente (SQLite ou AsyncStorage).

Exibir uma tela com ruas e casas.

Permitir marcar como "visitada".

Enviar leituras para o Supabase assim que estiver online.

ğŸ§  FUNCIONALIDADES PRINCIPAIS
ğŸ”„ 1. Sincronizar roteiro quando online
No inÃ­cio do dia (ou no final do dia anterior), ao detectar conexÃ£o:

ts
Copiar
Editar
// services/syncService.ts
import { supabase } from './supabaseClient';
import AsyncStorage from '@react-native-async-storage/async-storage';

export async function syncRoteiroDoDia(data: string) {
  const { data: roteiro, error } = await supabase
    .from('roteiros')
    .select('*')
    .eq('data', data);

  if (error) throw error;

  await AsyncStorage.setItem(`roteiro-${data}`, JSON.stringify(roteiro));
}
ğŸ“¦ 2. Salvar localmente com AsyncStorage ou SQLite
Com AsyncStorage (mais simples):
ts
Copiar
Editar
// salvar
await AsyncStorage.setItem('roteiro-2025-03-30', JSON.stringify(roteiro));

// ler
const json = await AsyncStorage.getItem('roteiro-2025-03-30');
const roteiro = json ? JSON.parse(json) : [];
ğŸ“± 3. Exibir a tela com o roteiro
Crie uma tela que organize os dados por rua e exiba os nÃºmeros com checkboxes.

tsx
Copiar
Editar
// components/RoteiroList.tsx
{
  roteiroAgrupado.map((rua, index) => (
    <View key={index}>
      <Text style={styles.ruaTitulo}>ğŸ“ {rua.nome}</Text>
      {rua.casas.map((casa) => (
        <TouchableOpacity key={casa.numero} onPress={() => marcarComoVisitada(casa)}>
          <Text style={casa.visitada ? styles.lida : styles.pendente}>
            {casa.numero} {casa.visitada ? 'âœ”ï¸' : 'â³'}
          </Text>
        </TouchableOpacity>
      ))}
    </View>
  ))
}
ğŸŸ¢ 4. Detectar conexÃ£o e sincronizar
ts
Copiar
Editar
import NetInfo from '@react-native-community/netinfo';

NetInfo.fetch().then(state => {
  if (state.isConnected) {
    // sincroniza roteiro e envia leituras pendentes
  }
});
ğŸ“ 5. Marcar casa como visitada
Atualize o campo visitada = true localmente (no AsyncStorage ou SQLite), e salve com timestamp.

ts
Copiar
Editar
function marcarComoVisitada(casa) {
  casa.visitada = true;
  casa.horario = new Date().toISOString();
  atualizarLocalmente(); // salva no storage
}
ğŸ“¤ 6. Quando online, enviar leituras
Verifica quais leituras tÃªm visitada = true && enviada = false.

Envia para Supabase com dados:

cliente_id

valor da leitura

data/hora

foto (se tiver)

ğŸ—‚ï¸ Estrutura de dados sugerida localmente (AsyncStorage ou SQLite)
ts
Copiar
Editar
{
  data: '2025-03-30',
  roteiro: [
    {
      rua: 'Rua GetÃºlio Vargas',
      casas: [
        { numero: '123', cliente_id: 'abc123', visitada: false },
        { numero: '125', cliente_id: 'abc124', visitada: true, leitura: 131187, horario: '2025-03-30T08:30' }
      ]
    }
  ]
}
âœ… Checklist do que seu programador precisa implementar:
 FunÃ§Ã£o para buscar roteiro do dia no Supabase.

 Armazenar roteiro localmente (AsyncStorage ou SQLite).

 Tela com agrupamento por rua e checklist de casas.

 DetecÃ§Ã£o de conexÃ£o para sincronizar.

 Enviar leituras pendentes ao Supabase quando online.

 Tela com indicador de progresso: "3 de 10 casas lidas".